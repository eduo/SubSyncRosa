#tag WindowBegin Window subWindow   BackColor       =   16777215   Backdrop        =   0   CloseButton     =   True   Composite       =   True   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   432   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   2048   MenuBar         =   19729314   MenuBarVisible  =   True   MinHeight       =   350   MinimizeButton  =   True   MinWidth        =   415   Placement       =   0   Resizeable      =   True   Title           =   "{AppName}"   Visible         =   True   Width           =   480   Begin GroupBox MainSubBox      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Subtitle - List View"      Enabled         =   True      Height          =   372      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   False      LockTop         =   True      Scope           =   0      TabIndex        =   7      TabPanelIndex   =   0      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   8      Underline       =   ""      Visible         =   True      Width           =   440      Begin Label Label3         AutoDeactivate  =   True         Bold            =   True         DataField       =   ""         DataSource      =   ""         Enabled         =   False         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "MainSubBox"         Italic          =   ""         Left            =   105         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   False         LockRight       =   True         LockTop         =   False         Multiline       =   ""         Scope           =   0         Selectable      =   False         TabIndex        =   1         TabPanelIndex   =   0         Text            =   "Re-Open with encoding:"         TextAlign       =   0         TextColor       =   0         TextFont        =   "SmallSystem"         TextSize        =   0         TextUnit        =   0         Top             =   315         Transparent     =   False         Underline       =   ""         Visible         =   True         Width           =   171      End      Begin SubGridBox mainSubList         AreaSelection   =   False         AutoDeactivate  =   True         CellEvenColor   =   13421772         CellOddColor    =   13421772         Cols            =   3         CornerBtnEnabled=   False         DefaultColumnWidth=   0         DefaultRowHeight=   50         Enabled         =   True         EvenBackColor   =   13421772         FreezeCols      =   0         GetFocusOnClick =   True         GridLineColor   =   13421772         HasBackColor    =   False         HasCellGridLineColor=   True         HasHeader       =   True         HasInactiveSelectionColor=   False         HasOutOfBoundsGridLineColor=   False         HasSelectedTextColor=   False         HasSelectionColor=   False         Height          =   263         HelpTag         =   ""         HorizontalGrid  =   True         HorizontalScrollbar=   False         HotTrack        =   False         InactiveSelectionColor=   13421772         Index           =   -2147483648         InitialParent   =   "MainSubBox"         Left            =   34         LiveScroll      =   True         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   True         LockRight       =   True         LockTop         =   True         mode            =   """""new"""""         OddBackColor    =   13421772         OutOfBoundsGridLineColor=   13421772         PopupMenuCellFullSensitivity=   False         RenderSortOrder =   False         Rows            =   0         Scope           =   0         SelectedTextColor=   0         selectEndRow    =   -1         SelectEntireRow =   True         SelectionColor  =   13421772         selectStartRow  =   -1         ShadeSelection  =   False         ShowResizeGlyph =   False         StartupCocoaFont=   "SmallSystem"         StartupLinuxFont=   "Geneva"         StartupLinuxFontSize=   9         StartupMacFont  =   "SmallSystem"         StartupMacFontSize=   10         StartupWin32Font=   "MS Sans Serif"         StartupWin32FontSize=   9         TabIndex        =   2         TabPanelIndex   =   0         TabStop         =   True         Top             =   40         UseFocusRing    =   True         VerticalGrid    =   False         VerticalScrollbar=   True         Visible         =   True         Width           =   412      End      Begin PushButton PushButton4         AutoDeactivate  =   True         Bold            =   ""         ButtonStyle     =   0         Cancel          =   ""         Caption         =   "Cancel"         Default         =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "MainSubBox"         Italic          =   ""         Left            =   34         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   False         Scope           =   0         TabIndex        =   3         TabPanelIndex   =   0         TabStop         =   True         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   344         Underline       =   ""         Visible         =   True         Width           =   80      End      Begin PushButton PushButton5         AutoDeactivate  =   True         Bold            =   ""         ButtonStyle     =   0         Cancel          =   ""         Caption         =   "Save"         Default         =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "MainSubBox"         Italic          =   ""         Left            =   366         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   False         LockRight       =   True         LockTop         =   False         Scope           =   0         TabIndex        =   4         TabPanelIndex   =   0         TabStop         =   True         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   344         Underline       =   ""         Visible         =   True         Width           =   80      End      Begin PushButton PushButton6         AutoDeactivate  =   True         Bold            =   ""         ButtonStyle     =   0         Cancel          =   ""         Caption         =   "Revert"         Default         =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "MainSubBox"         Italic          =   ""         Left            =   125         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   False         Scope           =   0         TabIndex        =   5         TabPanelIndex   =   0         TabStop         =   True         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   344         Underline       =   ""         Visible         =   True         Width           =   80      End      Begin PopupMenu charSetMenu         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   False         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "MainSubBox"         InitialValue    =   ""         Italic          =   ""         Left            =   270         ListIndex       =   0         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   False         LockRight       =   True         LockTop         =   False         Scope           =   0         TabIndex        =   6         TabPanelIndex   =   0         TabStop         =   True         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   313         Underline       =   ""         Visible         =   True         Width           =   176      End      Begin ProgressWheel subProgressWheel         AutoDeactivate  =   True         Enabled         =   True         Height          =   16         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "MainSubBox"         Left            =   340         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   False         LockRight       =   True         LockTop         =   False         Scope           =   0         TabIndex        =   7         TabPanelIndex   =   0         TabStop         =   True         Top             =   346         Visible         =   False         Width           =   16      End   End   Begin QTKit.QTCaptureView QTCaptureView1      AcceptFocus     =   ""      AcceptTabs      =   ""      AutoDeactivate  =   True      Backdrop        =   ""      DoubleBuffer    =   False      Enabled         =   True      EraseBackground =   True      Height          =   32      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   2      LockBottom      =   False      LockedInPosition=   False      LockLeft        =   False      LockRight       =   False      LockTop         =   False      Scope           =   0      TabIndex        =   11      TabPanelIndex   =   0      TabStop         =   True      Top             =   -58      UseFocusRing    =   True      Visible         =   False      Width           =   33   End   Begin Timer Timer3      Height          =   32      Index           =   -2147483648      InitialParent   =   ""      Left            =   109      LockedInPosition=   False      Mode            =   2      Period          =   10      Scope           =   0      TabPanelIndex   =   0      Top             =   -58      Width           =   32   End   Begin PushButton AddMasterSubButton      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "I want to sync with another sub"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   False      LockTop         =   False      Scope           =   0      TabIndex        =   12      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   392      Underline       =   ""      Visible         =   True      Width           =   228   End   Begin WindowSplitter VerticalSplitter      AutoDeactivate  =   True      CarbonLiveMove  =   True      ClassicLiveMove =   False      DockAfter       =   False      DockAfterSize   =   40      DockBefore      =   False      DockBeforeSize  =   40      DoubleClickAction=   0      Enabled         =   ""      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   450      LinuxStyle      =   3      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      MacFailStyle    =   0      MacStyle        =   0      MinAfterArea    =   35      MinBeforeArea   =   35      Scope           =   0      TabIndex        =   13      TabPanelIndex   =   0      TabStop         =   True      Top             =   392      Visible         =   True      Width           =   10      WinLiveMove     =   False      WinStyle        =   0   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Function CancelClose(appQuitting as Boolean) As Boolean		  dim dlog as MessageDialog		  dim btn as MessageDialogButton		  		  // Create Dialog		  if self.ContentsChanged = true then		    dlog = New MessageDialog		    dlog.Message = "Do you want to save changes to this document before closing?"		    dlog.Explanation = "If you don't save, your changes will be lost."		    dlog.ActionButton.Caption = "&Save"		    dlog.CancelButton.Caption = "Cancel"		    dlog.CancelButton.Visible = true		    dlog.AlternateActionButton.Caption = "&Don't Save"		    dlog.AlternateActionButton.Visible = true		    		    // Show Dialog		    btn = dlog.ShowModal		    		    // Act on User's Choice		    Select Case btn.Caption		    Case "&Save"		      'MsgBox "Saved!"		      dim ok as boolean = mainSubList.saveSubtitle		      if ok then self.ContentsChanged = false		      return ok		    Case "Cancel"		      return true		    Case "&Don't Save"		      return false		    end Select		  end if		End Function	#tag EndEvent	#tag Event		Sub Open()		  'app.AutoQuit = True		  Me.ReplaceAppStrings		End Sub	#tag EndEvent	#tag Event		Sub Resized()		  if thisMasterSubCC <> nil then		    self.MaxWidth = self.MaxWidth+thisMasterSubCC.Width		    MainSubBox.LockRight = false		    'MainSubBox.Width = self.Width/2		    'thisMasterSubCC.left = MainSubBox.Left+MainSubBox.Width		    'thisMasterSubCC.Width = self.Width - (MainSubBox.Width+MainSubBox.Left)		  else		    MainSubBox.LockRight = true		  end if		  		  'AddMasterSubButton.Left = MainSubBox.Left + MainSubBox.Width - AddMasterSubButton.Width		End Sub	#tag EndEvent	#tag Method, Flags = &h0		Sub AddMasterSub()		  		  If thisMasterSubCC <> Nil Then		    		    thisMasterSubCC.Visible = False		    		    Width = width - MainSubBox.Width		    		    thisMasterSubCC.Close		    Dim temp As MasterSubCC		    thisMasterSubCC = temp		    thisMasterSubCC.loadNewSub		    		    AddMasterSubButton.Caption = "I want to sync with another sub"		    		    VerticalSplitter.Visible = true		    verticalSplitter.AddControl thisMasterSubCC,false		    verticalSplitter.AddControl MainSubBox,true		    		    		  Else		    		    thisMasterSubCC = New MasterSubCC		    thisMasterSubCC.loadNewSub		    		    MainSubBox.LockRight = False		    width = width + MainSubBox.Width		    thisMasterSubCC.EmbedWithin(Self,MainSubBox.Left + MainSubBox.Width,MainSubBox.Top,MainSubBox.Width,MainSubBox.Height)		    		    AddMasterSubButton.Caption = "Close Master Sub"		    		  End If		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub AddMasterSub(thisfile as FolderItem)		  If thisMasterSubCC <> Nil Then		    		    thisMasterSubCC.Visible = False		    		    Width = width - MainSubBox.Width		    		    thisMasterSubCC.Close		    Dim temp As MasterSubCC		    thisMasterSubCC = temp		    thisMasterSubCC.loadNewSub(thisfile)		    		    AddMasterSubButton.Caption = "I want to sync with another sub"		    		    VerticalSplitter.Visible = true		    verticalSplitter.AddControl thisMasterSubCC,false		    verticalSplitter.AddControl MainSubBox,true		    		    		  Else		    		    thisMasterSubCC = New MasterSubCC		    thisMasterSubCC.loadNewSub(thisfile)		    		    MainSubBox.LockRight = False		    width = width + MainSubBox.Width		    thisMasterSubCC.EmbedWithin(Self,MainSubBox.Left + MainSubBox.Width,MainSubBox.Top,MainSubBox.Width,MainSubBox.Height)		    		    AddMasterSubButton.Caption = "Close Master Sub"		    		  End If		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub calculateAdjustment()		  if thisMovieCC <> nil then		    		    dim linesToAdjust as integer		    		    dim slaveSubs,masterSubs as subClass		    dim slaveGrid,masterGrid as SubGridBox		    		    slaveGrid = mainSubList		    masterGrid = thisMasterSubCC.masterSubList		    		    if slaveGrid.rows > 0 and masterGrid.rows > 0 then		      		      slaveSubs = mainSubList.mySub		      masterSubs = thisMasterSubCC.masterSubList.mySub		      		      dim origCount as integer = slaveSubs.count		      linesToAdjust = origCount		      		      if thisMasterSubCC.adjustAllCheckbox.Value then		        linesToAdjust = origCount		      else		        dim startRow as integer = max(slaveGrid.selectStartRow,0)		        dim endRow as integer = max(slaveGrid.selectEndRow,0)		        if startRow > 0 then		          		        end if		        		        if endRow > 0 then		          		        end if		        		        linesToAdjust = endRow - (startRow -1)		        		      end if		      		      dim startTimeMaster,endTimeMaster as double		      		      dim startTimeDiff,endTimeDiff as double		      		      endTimeMaster = masterSubs.subLines(max(masterGrid.selectEndRow,0)-1).endSeconds		      startTimeMaster = masterSubs.subLines(max(masterGrid.selectStartRow,0)-1).endSeconds		      		      dim startTimeSlave,endTimeSlave as double		      endTimeSlave = slaveSubs.subLines(max(slaveGrid.selectEndRow,0)-1).endSeconds		      startTimeSlave = slaveSubs.subLines(max(slaveGrid.selectStartRow,0)-1).endSeconds		      		      startTimeDiff = startTimeSlave - startTimeMaster		      endTimeDiff = endTimeSlave - endTimeMaster		      		      dim timeDiffMSG as string		      		      timeDiffMSG = "shift "		      		      if startTimeDiff = 0 then		        timeDiffMSG = timeDiffMSG+"0s / "		      elseif startTimeDiff > 0 then		        timeDiffMSG = timeDiffMSG+str(startTimeDiff)+"s / "		      else		        timeDiffMSG = timeDiffMSG+str(startTimeDiff)+"s / "		      end if		      		      timeDiffMSG=timeDiffMSG+"resize "		      		      if endTimeDiff = 0 then		        timeDiffMSG = timeDiffMSG+"0s"		      elseif endTimeDiff > 0 then		        timeDiffMSG = timeDiffMSG+str(endTimeDiff)+"s"		      else		        timeDiffMSG = timeDiffMSG+str(endTimeDiff)+"s"		      end if		      		      timeDiffMSG = timeDiffMSG + " ("+str(LinesToAdjust)+" lines)"		      		    end if		    		  end if		End Sub	#tag EndMethod	#tag Method, Flags = &h0		 Shared Function TimeToString(s as double, fmt as string) As string		  #pragma DisableBackgroundTasks		  dim mins as Integer = s / 60		  dim secs as double = s - (mins*60)		  dim sex as string = Format( secs, fmt )		  if rightb( sex, 1 ) = "." then sex = sex.leftb( lenb( sex ) - 1 )		  if mins <> 0 then		    sex = str( mins ) + ":" + sex		  end if		  Return sex		End Function	#tag EndMethod	#tag Note, Name = Referencias		Iconos http://code.google.com/p/google-maps-icons/wiki/NumericIcons							#tag EndNote	#tag Property, Flags = &h0		hasMovie As boolean	#tag EndProperty	#tag Property, Flags = &h0		loadedSub As subLine	#tag EndProperty	#tag Property, Flags = &h0		thisMasterSubCC As MasterSubCC	#tag EndProperty	#tag Property, Flags = &h0		thisMovieCC As MovieCC	#tag EndProperty	#tag Property, Flags = &h0		verticalSplit As WindowSplitter	#tag EndProperty#tag EndWindowCode#tag Events mainSubList	#tag Event		Sub AfterMouseDown(x as Integer,y as Integer,isHeader as Boolean)		  If Keyboard.AltKey Or Keyboard.ShiftKey Then		    calculateAdjustment		  End 		  		  Dim thisSelection As StyleGridSelection		  thisSelection = Me.selection		  		  If thisSelection.RowCount= 0 Then		    Dim column As Integer,row As Integer		    Me.CellFromPoint(x,y,column,row)		    		    Dim thisTime As qtkit.qttime		    		    If thisMovieCC <> Nil Then		      		      If thisMovieCC.QTMovieView1.movie <> Nil Then		        		        Dim thisLine As subLine		        thisLine = Me.row(row).ItemData		        thistime.timeValue = thisLine.startSeconds*1000		        thisTime.timeScale = 1000		        		        Dim thisRange As QTKit.QTtimeRange		        		        thisMovieCC.QTMovieView1.movie.CurrentTime = thisTime		        thisRange.time = thisTime		        thistime.timeValue = 3*1000		        thisRange.duration = thisTime		        thisMovieCC.QTMovieView1.movie.SetSelection(thisRange)		        thisMovieCC.QTMovieView1.Play		      End If		    End If		  End If		  		End Sub	#tag EndEvent#tag EndEvents#tag Events PushButton5	#tag Event		Sub Action()		  dim ok as boolean = mainSubList.saveSubtitle		  		  if ok then self.ContentsChanged = false		  		End Sub	#tag EndEvent#tag EndEvents#tag Events PushButton6	#tag Event		Sub Action()		  dim sl as SubGridBox = mainSubList		  		  subProgressWheel.Visible = true		  sl.LockDrawing = true		  sl.ParseSubtitle(sl.mySub.subFile)		  sl.AdjustListBoxSize(10)		  sl.LockDrawing = false		  subProgressWheel.Visible = false		End Sub	#tag EndEvent#tag EndEvents#tag Events charSetMenu	#tag Event		Sub Change()		  dim sl as SubGridBox = mainSubList		  		  if sl.rows > 0 then		    if me.ListIndex > -1 then		      dim thisValue as variant = me.RowTag(me.ListIndex)		      		      sl.LockDrawing = True		      		      if thisValue <> nil then		        If not thisValue isa TextEncoding then		          if thisValue = "auto" Then		            sl.mySub.Encoding = Nil		            sl.ParseSubtitle(sl.mySub.subFile)		            dim ok as boolean		            ok = sl.paintRows(1,1)		            sl.AdjustListBoxSize(10)		          end if		        Elseif thisValue IsA TextEncoding then		          if thisValue = sl.mySub.Encoding Then		          Else		            sl.mysub.Encoding = thisValue		            sl.ParseSubtitle(sl.mySub.subFile)		            'system.Log(system.LogLevelError,"Finished")		            dim ok as boolean		            ok = sl.paintRows(1,1)		            sl.AdjustListBoxSize(10)		            		          end if		        End If		      end if		      sl.LockDrawing = False		    end if		  end if		  		  Dim thisEnc As TextEncoding = sl.mySub.Encoding		  For i As Integer = 0 To me.ListCount -1		    		    If me.RowTag(i) IsA TextEncoding Then		      If me.RowTag(i)= thisEnc Then		        me.ListIndex = i		        Exit For i		      End If		    End If		  Next		  		  		End Sub	#tag EndEvent	#tag Event		Sub Open()		  'for i as integer = 0 to encodings.Count -1		  'me.AddRow(encodings.item(i).internetName + "/" + str(encodings.item(i).code))		  'next		  		  me.AddRow("UTF8")		  me.RowTag(me.listcount -1)=encodings.UTF8		  me.AddRow("ISOLatin1")		  me.RowTag(me.listcount -1)=encodings.ISOLatin1		  me.AddSeparator		  me.AddRow("Auto-Detect")		  me.RowTag(me.listcount -1)="auto"		End Sub	#tag EndEvent#tag EndEvents#tag Events QTCaptureView1	#tag Event		Sub Close()		  'dim currentSession as QTCaptureSession = QTCaptureView1.CaptureSession		  'if currentSession <> nil and currentSession.IsRunning then		  'currentSession.StopRunning		  'end if		End Sub	#tag EndEvent#tag EndEvents#tag Events Timer3	#tag Event		Sub Action()		  If thisMovieCC <> Nil Then		    		    Dim showsub As Boolean = False		    		    Dim blankSub As New subLine		    Dim thisTime As qtkit.qttime		    Dim thisInstant As Double		    		    If thisMovieCC.QTMovieView1.movie <> Nil Then		      thisTime = thisMovieCC.QTMovieView1.Movie.CurrentTime		      thisInstant = thisTime.timeValue/thisTime.timeScale		      		      If loadedSub <> Nil Then		        		        Dim subSTime As qtkit.qttime		        Dim thisLine As subLine = loadedSub		        subStime.timeValue = thisLine.startSeconds*1000		        subStime.timeScale = 1000		        		        Dim subETime As qtkit.qttime		        subEtime.timeValue = thisLine.endSeconds*1000		        subEtime.timeScale = 1000		        		        Dim startInstant,endInstant As Double		        startInstant = subStime.timeValue/subSTime.timeScale		        endInstant = subEtime.timeValue/subETime.timeScale		        		        If thisInstant <= endInstant And startInstant <= thisInstant Then		          Exit Sub		        Else		          blankSub.subText.Append " "		          loadedSub = blankSub		          showsub = True		        End If		        		      End If		      		    End If		    		    Dim thisSubLine As subLine		    		    For i As Integer = 1 To mainSubList.Rows		      Dim subSTime As qtkit.qttime		      Dim thisLine As subLine		      thisLine = mainSubList.row(i).ItemData		      subStime.timeValue = thisLine.startSeconds*1000		      subStime.timeScale = 1000		      		      Dim subETime As qtkit.qttime		      subEtime.timeValue = thisLine.endSeconds*1000		      subEtime.timeScale = 1000		      		      Dim startInstant As Double		      Dim endInstant As Double		      startInstant = subStime.timeValue/subSTime.timeScale		      endInstant = subEtime.timeValue/subETime.timeScale		      		      If thisInstant <= endInstant And startInstant <= thisInstant Then		        thisSubLine = thisLine		        loadedSub = thisSubLine		        Exit For i		      End If		      		    Next		    		    If showsub Then  thisMovieCC.RefreshSub loadedSub		    		  End If		End Sub	#tag EndEvent#tag EndEvents#tag Events AddMasterSubButton	#tag Event		Sub Action()		  AddMasterSub		End Sub	#tag EndEvent	#tag Event		Sub DropObject(obj As DragItem, action As Integer)		  if obj.FolderItemAvailable then AddMasterSub(obj.FolderItem)		End Sub	#tag EndEvent	#tag Event		Sub Open()		  me.AcceptFileDrop("???")		End Sub	#tag EndEvent#tag EndEvents